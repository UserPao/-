## Dubbo

- Dubbo是一个RPC框架

  什么是RPC

  RPC（Remote Procedure Call）—远程过程调用，它是一种通过网络从远程计算机程序上请求服务，而不需要了解
  底层网络技术的协议。比如两个不同的服务A,B部署在两台不同的机器上，那么服务 A 如果想要调用服务 B 中的某个
  方法该怎么办呢？使用 HTTP请求 当然可以，但是可能会比较慢而且一些优化做的并不好。 RPC 的出现就是为了解
  决这个问题 

  

  ![1582376847128](C:\Users\32091\AppData\Roaming\Typora\typora-user-images\1582376847128.png)

- 为什么要用Dubbo

  - 负载均衡 ——同一个服务部署在不同的机器时该调用哪一台上的服务
  - 服务调用链路生成——系统的发展，服务越来越多，服务间依赖关系变得错综复杂，甚至分不清哪个应用应该在哪个应用前启动，Dubbo可以解决服务之间互相是如何调用的
  - 服务访问压力以及时长统计，资源调度和治理——基于访问压力实时管理集群容量，提高集群利用率
  - 服务降级——某个服务挂掉之后调用服务备用服务

- Dubbo框架

  ![1582378661135](C:\Users\32091\AppData\Roaming\Typora\typora-user-images\1582378661135.png)

  - provider:暴露服务的服务提供方
  - Consumer：调用远程服务的服务消费方
  - Regisrty：服务注册与发现的注册中心
  - Monitor：统计服务的调用次数和调用时间的监控中心
  - Container：服务运行容器

- 调用关系说明

  - 服务容器负责启动，加载，运行服务提供者。
  - 服务提供者在启动时，向注册中心注册自己提供的服务。
  - 服务消费者在启动时，向注册中心订阅自己所需的服务。
  - 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。
  - 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一
    台调用。
  - 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心 

- 重点知识总结

  - 注册中心负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注
    册中心不转发请求，压力较小
  - 监控中心负责统计各服务调用次数，调用时间等，统计先在内存汇总后每分钟一次发送到监控中心服务器，并
    以报表展示
  - 注册中心，服务提供者，服务消费者三者之间均为长连接，监控中心除外
  - 注册中心通过长连接感知服务提供者的存在，服务提供者宕机，注册中心将立即推送事件通知消费者
  - 注册中心和监控中心全部宕机，不影响已运行的提供者和消费者，消费者在本地缓存了提供者列表
  - 注册中心和监控中心都是可选的，服务消费者可以直连服务提供者
  - 服务提供者无状态，任意一台宕掉后，不影响使用
  - 服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复 

- Dubbo的负载均衡策略

